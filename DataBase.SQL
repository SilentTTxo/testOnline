CREATE DATABASE exam
CHARACTER SET 'utf8'
COLLATE 'utf8_general_ci';
USE exam;
CREATE TABLE USER (
	ID			INT AUTO_INCREMENT PRIMARY KEY,
	USERNAME	TEXT,
	PASSWORD	TEXT,
	SEX			TEXT,
	NAME		TEXT,
	TEL 		TEXT,
	EMAIL		TEXT,
	POWER		INT DEFAULT 1,
	OTHER		TEXT
)ENGINE=InnoDB DEFAULT CHARSET=utf8;
CREATE TABLE QUESTION (
	ID 			INT AUTO_INCREMENT PRIMARY KEY,
	DIS 		TEXT,
	ANSNUM		INT,
	ANSA		TEXT,
	ANSB		TEXT,
	ANSC		TEXT,
	ANSD		TEXT,
	ANSE		TEXT
)ENGINE=InnoDB DEFAULT CHARSET=utf8;
CREATE TABLE EXAM (
	ID 			INT AUTO_INCREMENT PRIMARY KEY,
	NAME		TEXT,
	STARTDATE	DATETIME,
	EMDDATE		DATETIME
)ENGINE=InnoDB DEFAULT CHARSET=utf8;
CREATE TABLE EXQUE (
	ID 			INT AUTO_INCREMENT PRIMARY KEY,
	QUEID		INT,
	EXID		INT,
	FOREIGN		KEY(QUEID) REFERENCES QUESTION(ID),
	FOREIGN		KEY(EXID) REFERENCES EXAM(ID)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;
CREATE TABLE SCORE (
	ID 			INT AUTO_INCREMENT PRIMARY KEY,
	USERID		INT,
	EXID		INT,
	SCO 		INT,
	FOREIGN		KEY(USERID) REFERENCES USER(ID),
	FOREIGN		KEY(EXID) REFERENCES EXAM(ID)
)ENGINE=InnoDB DEFAULT CHARSET=utf8;
CREATE VIEW ALLEXAM AS SELECT * FROM QUESTION NATURAL JOIN EXQUE; 
CREATE VIEW SEVIEW AS SELECT NAME,SCO,USERID from SCORE NATURAL join EXAM;
CREATE VIEW SEUVIEW AS SELECT SEVIEW.NAME AS EXNAME,USERID,`USER`.USERNAME AS USERNAME,SCO FROM SEVIEW LEFT JOIN USER ON SEVIEW.USERID = USER.ID

//TEMP
CREATE VIEW SCOVIEW AS (SELECT TEMP.`NAME` AS EXNAME,USERID,USER.NAME AS USERNAME,SCO from (SELECT NAME,SCO,USERID from SCORE NATURAL join EXAM) AS TEMP LEFT JOIN `USER` on `USER`.ID = TEMP.USERID); 
CREATE VIEW SEVIEW AS SELECT NAME,SCO,USERID from SCORE NATURAL join EXAM;